<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Thêm Sản Phẩm</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">
    <style>
        .toast-container {
            z-index: 1050;
        }

        .toast {
            width: 350px;
        }

        .toast-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            border-top-left-radius: calc(0.25rem - 1px);
            border-top-right-radius: calc(0.25rem - 1px);
        }

        .toast-body {
            padding: 0.75rem 1rem;
        }

        .toast .btn-close {
            padding: 0.25rem 0.5rem;
            margin: -0.25rem -0.5rem -0.25rem auto;
        }

        .toast-header.bg-danger {
            background-color: #dc3545;
        }

        .toast-header.bg-success {
            background-color: #198754;
        }

        .toast-header.text-white {
            color: #fff;
        }

        .toast-header .btn-close-white {
            filter: invert(1);
        }
    </style>
</head>
<body>
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item active text-primary" aria-current="page">Form Products</li>
        <li class="breadcrumb-item"><a href="/admin/products/list">List Products</a></li>
    </ol>
</nav>

<div class="container">
    <h1>Thêm Sản Phẩm</h1>
    <form th:action="@{/admin/products/create}" method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
        <div class="card col-1000">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="productName">Tên sản phẩm:</label>
                            <input type="text" class="form-control" id="productName" name="productName"
                                   th:value="${itemProd.productName}" required>
                            <div class="invalid-feedback">Tên sản phẩm là bắt buộc.</div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="price">Giá bán:</label>
                            <input type="number" class="form-control" id="price" name="price"
                                   th:value="${itemProd.price}" required>
                            <div class="invalid-feedback">Giá bán là bắt buộc.</div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="discountPercentage">Phần trăm giảm giá:</label>
                            <input type="number" class="form-control" id="discountPercentage" name="discountPercentage"
                                   th:value="${itemProd.discountPercentage}" required>
                            <div class="invalid-feedback">Phần trăm giảm giá là bắt buộc.</div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="manufacturer">Nhà sản xuất:</label>
                            <input type="text" class="form-control" id="manufacturer" name="manufacturer"
                                   th:value="${itemProd.manufacturer}" required>
                            <div class="invalid-feedback">Nhà sản xuất là bắt buộc.</div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="postingDate">Ngày đăng bán:</label>
                            <input type="date" class="form-control" id="postingDate" name="postingDate"
                                   th:value="${itemProd.postingDate}" required>
                            <div class="invalid-feedback">Ngày đăng bán là bắt buộc.</div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label>Hình ảnh:</label>
                            <input type="file" class="form-control" name="img" />
                            <br>
                            <div th:if="${itemProd.imageId != null}">
                                <img th:src="@{/Image_SP/{imageName}(imageName=${itemProd.imageId.imageName})}"
                                     alt="Product Image" style="max-width: 200px;">
                            </div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="publishingYear">Năm xuất bản:</label>
                            <input type="number" class="form-control" id="publishingYear" name="publishingYear"
                                   th:value="${itemProd.publishingYear}" required>
                            <div class="invalid-feedback">Năm xuất bản là bắt buộc.</div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="weight">Khối lượng:</label>
                            <input type="text" class="form-control" id="weight" name="weight"
                                   th:value="${itemProd.weight}" required>
                            <div class="invalid-feedback">Khối lượng là bắt buộc.</div>
                        </div>
                        <br>
                    </div>
                    <div class="col-md-6">
                        <br>
                        <div class="form-group">
                            <label for="size">Kích thước:</label>
                            <input type="text" class="form-control" id="size" name="size"
                                   th:value="${itemProd.size}" required>
                            <div class="invalid-feedback">Kích thước là bắt buộc.</div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="numberOfPages">Số trang:</label>
                            <input type="text" class="form-control" id="numberOfPages" name="numberOfPages"
                                   th:value="${itemProd.numberOfPages}" required>
                            <div class="invalid-feedback">Số trang là bắt buộc.</div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="language">Ngôn ngữ:</label>
                            <input type="text" class="form-control" id="language" name="language"
                                   th:value="${itemProd.language}" required>
                            <div class="invalid-feedback">Ngôn ngữ là bắt buộc.</div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="author">Tác giả:</label>
                            <input type="text" class="form-control" id="author" name="author"
                                   th:value="${itemProd.author}" required>
                            <div class="invalid-feedback">Tác giả là bắt buộc.</div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="description">Mô tả:</label>
                            <textarea class="form-control" id="description" name="description" rows="5"
                                      th:text="${itemProd.description}" required></textarea>
                            <div class="invalid-feedback">Mô tả là bắt buộc.</div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="quantity">Số lượng:</label>
                            <input type="number" name="quantity" id="quantity" th:value="${itemProd.quantity}"
                                   class="form-control" placeholder="Số lượng" required>
                            <div class="invalid-feedback">Số lượng là bắt buộc.</div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="category" class="form-label">Loại:</label>
                            <select class="form-select" name="categoryId" required>
                                <option th:each="category : ${categories}"
                                        th:value="${category.categoryId}"
                                        th:selected="${itemProd.category != null and itemProd.category.categoryId == category.categoryId}">
                                    <span th:text="${category.categoryName}"></span>
                                </option>
                            </select>
                            <div class="invalid-feedback">Vui lòng chọn loại sản phẩm.</div>
                        </div>
                        <br>
                        <div class="form-group">
                            <label for="statusId" class="form-label">Trạng thái:</label>
                            <select class="form-select" id="statusId" name="statusId" required>
                                <option value="" disabled th:if="${status == null}">Chọn trạng thái</option>
                                <option th:each="status : ${productStatus}"
                                        th:value="${status.statusId}"
                                        th:selected="${itemProd?.status?.statusId == status.statusId}"
                                        th:text="${status.statusName}"></option>
                            </select>
                            <div class="invalid-feedback">Vui lòng chọn trạng thái!</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer text-muted">
                <button class="btn btn-outline-success" type="submit">Create</button>
                <button class="btn btn-outline-warning" formaction="/admin/products/reset">Reset</button>
            </div>
        </div>
    </form>

    <!-- Toast Message -->
    <div aria-live="polite" aria-atomic="true" style="position: fixed; top: 90px; right: 100px; width: 280px; z-index: 1050;">
        <div class="toast-container">
            <div th:if="${errorMessage != null}" class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header bg-danger text-white">
                    <strong class="me-auto">Lỗi</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body" th:text="${errorMessage}"></div>
            </div>
            <div th:if="${successMessage != null}" class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header bg-success text-white">
                    <strong class="me-auto">Thành công</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body" th:text="${successMessage}"></div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var toastElList = [].slice.call(document.querySelectorAll('.toast'));
        var toastList = toastElList.map(function (toastEl) {
            return new bootstrap.Toast(toastEl, {delay: 5000});
        });
        toastList.forEach(function (toast) {
            toast.show();
        });

        // Custom validation for form
        var forms = document.querySelectorAll('.needs-validation');
        Array.prototype.slice.call(forms).forEach(function (form) {
            form.addEventListener('submit', function (event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    });
</script>
</body>
</html>

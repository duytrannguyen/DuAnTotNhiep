<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Sản Phẩm</title>
<link rel="shortcut icon" href="/assets/images/logobook.ico"
	type="image/x-icon">

<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
	crossorigin="anonymous">
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
	crossorigin="anonymous"></script>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<!-- link icon -->
<!-- (Optional) Use CSS or JS implementation -->
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/js/all.min.js"
	integrity="sha512-naukR7I+Nk6gp7p5TMA4ycgfxaZBJ7MO5iC3Fp6ySQyKFHOGfpkSZkYVWV5R7u7cfAicxanwYQ5D1e17EfJcMA=="
	crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/client/products.css">
<!-- Additional CSS Files -->
<link rel="stylesheet" href="/assets/css/fontawesome.css">
<link rel="stylesheet" href="/assets/css/templatemo-liberty-market.css">
<link rel="stylesheet" href="/assets/css/owl.css">
<link rel="stylesheet" href="/assets/css/animate.css">
<link rel="stylesheet"
	href="https://unpkg.com/swiper@7/swiper-bundle.min.css" />
<style type="text/css">
body, html {
	margin: 0;
	padding: 0;
	height: 100%;
	width: 100%;
}

/* .page-heading { */
/* 	padding: 20px 0; */
/* 	background: #f5f5f5; */
/* } */
.container-fluid {
	padding: 20px;
}

.card {
	margin-bottom: 20px;
}

.pagination .page-item .page-link.selected {
	font-weight: bold;
}

.lb {
	padding: 5px;
}

.a-product {
	text-decoration: none;
}

.card-img-top {
	object-fit: cover;
	height: 230px;
	width: 100%;
}

.card-footer {
	background: #fff;
}

.pagination .page-item .page-link {
	border-radius: 0;
	color: #000;
}

.page-link:hover {
	background-color: #007bff;
	color: #fff;
}

.pagination .page-item .page-link.selected {
	font-weight: bold;
}

.lb {
	padding: 5px;
}

.giamGia {
	text-decoration: line-through;
}
</style>
</head>


<body>
	<div th:replace="~{client_layout/header :: header}"></div>
	<div class="page-heading normal-space">
		<div class="container-fluid">
			<div class="row">
				<div class="col-lg-12">
					<h1 style="text-align: center; font-size: xx-large;">Sản phẩm</h1>
				</div>
			</div>
		</div>
	</div>
	<div class="container-fluid">
		<div class="col-md-12 mt-5">
			<div class="row">
				<!-- NỘI DUNG TRÁI -->
				<div class="col-md-3">
					<div class="card">
						<!-- GIÁ -->
						<br>
						<ul>
							<!-- <<<<<<< duy -->
							<!-- 							<a><strong>GIÁ</strong></a> -->
							<!-- >>>>>>> di -->
							<strong style="padding: 20px">GIÁ</strong>

							<form action="/home/products" method="post"
								id="product-filter-form" onchange="this.submit()">
								<ul class="list-group">
									<li class="list-group-item"><input
										class="form-check-input me-1 price-filter" type="radio"
										name="price_range" value="0-100000" id="price0-100"> <label
										class="form-check-label" for="price0-100">Dưới
											100,000đ</label></li>
									<li class="list-group-item"><input
										class="form-check-input me-1 price-filter" type="radio"
										name="price_range" value="100000-200000" id="price100-250">
										<label class="form-check-label" for="price100-250">100,000đ
											- 250,000đ</label></li>
									<li class="list-group-item"><input
										class="form-check-input me-1 price-filter" type="radio"
										name="price_range" value="200000-300000" id="price200-350">
										<label class="form-check-label" for="price200-350">200,000đ
											- 350,000đ</label></li>
									<li class="list-group-item"><input
										class="form-check-input me-1 price-filter" type="radio"
										name="price_range" value="350000-500000" id="price350-500">
										<label class="form-check-label" for="pric350-500">350,000đ
											-500,000đ</label></li>
									<li class="list-group-item"><input
										class="form-check-input me-1 price-filter" type="radio"
										name="price_range" value="500000-999999999" id="price500-">
										<label class="form-check-label" for="price500-">Trên
											500,000đ</label></li>
								</ul>
							</form>

						</ul>
						<hr>
						<!-- THỂ LOẠI -->
						<ul class="ul">
							<!-- <<<<<<< duy -->
							<ul>
								<a><strong>THỂ LOẠI</strong></a>
								<form id="filter-form">
									<div class="form-group">
										<div class="form-check">
											<input class="form-check-input" type="radio"
												name="categoryId" id="categoryIdAll" value="0"
												onchange="redirectToProductPage()"> <label
												class="form-check-label" for="categoryIdAll">Tất cả</label>
										</div>
										<div th:each="c : ${categories}">
											<div class="form-check">
												<input class="form-check-input" type="radio"
													name="categoryId" th:value="${c.categoryId}"
													th:id="'category-' + ${c.categoryId}"
													onchange="submitFilterForm()"> <label
													class="form-check-label"
													th:for="'category-' + ${c.categoryId}">[[${c.categoryName}]]</label>
											</div>
										</div>
									</div>
								</form>

							</ul>
							<!-- ======= di -->
							<!-- 							<strong>THỂ LOẠI</strong>
							<form id="filter-form" action="/home/products" method="get">
								<div class="form-group">
									<div class="form-check">
										<input class="form-check-input" type="radio" name="categoryId"
											id="categoryIdAll" value="0"
											th:checked="${#lists.isEmpty(param.categoryId) or param.categoryId == 0}"
											onchange="this.form.submit()"> <label
											class="form-check-label" for="categoryIdAll">Tất cả</label>
									</div>
									<div th:each="c : ${categories}">
										<div class="form-check">
											<input class="form-check-input" type="radio"
												name="categoryId" th:id="'category-' + ${c.categoryId}"
												th:value="${c.categoryId}"
												th:checked="${param.categoryId == c.categoryId}"
												onchange="this.form.submit()"> <label
												class="form-check-label"
												th:for="'category-' + ${c.categoryId}"
												th:text="${c.categoryName}"></label>
										</div>
									</div>
								</div>
							</form> -->
						</ul>
					</div>
				</div>
				<!-- NỘI DUNG PHẢI -->
				<div class="col-md-9">
					<div class="card" style="padding: 20px">
						<div class="row">
							<div class="col-md-5">
								<!-- 							tìm kiếm giọng nói -->
								<label class="lb"><em><b>Tìm kiếm sản phẩm</b></em></label>
								<form class="d-flex" role="search" action="/home/products"
									method="get" id="searchForm">
									<input class="form-control me-2" type="search"
										aria-label="Search" name="keyName" id="searchInput">
									<button class="btn btn-outline-primary" type="submit">
										<i class="fa-solid fa-magnifying-glass"></i>
									</button>
									<button class="btn btn-outline-secondary ms-2" type="button"
										id="voiceButton">
										<i class="fa-solid fa-microphone microphone-icon"
											id="microphoneIcon"></i>
										<div class="recording-indicator" id="recordingIndicator"></div>
									</button>
								</form>
							</div>
						</div>
						<hr>
						<!-- DANH SÁCH SẢN PHẨM -->
						<!-- <<<<<<< duy -->
						<div class="row row-cols-1 g-4">
							<!-- <!-- <h6>DANH SÁCH SẢN PHẨM</h6> -->
							<div th:each="p : ${currentProducts}" class="col-md-3">
								<a th:href="'products/details/' + ${p.productId}"
									class="a-product text-decoration-none">
									<div class="card h-100 border-0 shadow-sm hover-shadow-lg">
										<img th:src="'/Image_SP/' + ${p.imageId.imageName}"
											class="card-img-top"
											style="height: 230px; width: 210px; margin-left: 18px;">
										<div class="card-body">
											<p class="card-title mb-1">[[${p.productName}]]</p>
											<div class="d-flex flex-column">
												<span class="giaBan">[[${#numbers.formatDecimal(p.price,
													0, 'COMMA')}]] VNĐ</span>
											</div>
										</div>
									</div>
								</a>
							</div>
						</div>
						<br>


						<!-- 						======= di -->

						<h6>DANH SÁCH SẢN PHẨM</h6>
						<br>
						<div class="row row-cols-1 row-cols-md-4 g-4">
							<div th:if="${noProductsFound}">
								<div colspan="7"><label class="text-danger"> <b>Không tìm
										thấy sản phẩm.</b></label></div>
							</div>

							<div th:each="p, iterStat : ${products}">
								<div class="col">
									<a th:href="@{/home/products/details/{id}(id=${p.productId})}"
										class="a-product text-decoration-none">
										<div class="card h-100 border-0 shadow-sm hover-shadow-lg">

											<img
												th:src="@{/Image_SP/{imageName}(imageName=${p.imageId.imageName})}"
												class="card-img-top"
												style="height: 230px; width: 210px; margin-left: 18px;">
											<div class="card-body">
												<h5 class="card-title" th:text="${p.productName}"></h5>
												<p th:text="${p.author}"></p>
												<div class="d-flex flex-column">
													<h5 style="color: red; font-weight: 700"
														th:text="${discountedPrices[iterStat.index]} + 'VNĐ'"></h5>
												</div>
												<p class="giamGia">
													<a th:text="${p.price}"></a> <a
														class="badge text-bg-danger"> - <b
														class="badge text-bg-danger"
														th:text="${p.discountPercentage}"></b>%
													</a>
												</p>


											</div>
										</div>
									</a>
								</div>

							</div>
						</div>

						<br>
						<!-- PHÂN TRANG -->
						<div class="card-footer d-flex justify-content-center">
							<nav aria-label="Page navigation example">
								<ul class="pagination mb-0">
									<!-- Nút Đầu -->
									<li class="page-item"><a
										class="page-link bg-black bg-gradient text-info hover-bg-primary hover-color-white btn-lg"
										th:href="@{/home/products(pageNo=0)}" aria-label="Previous">
											<span aria-hidden="true">&laquo;</span>
									</a></li>

									<!-- Số Trang -->
									<li
										th:each="pageNum, stat : ${#numbers.sequence(1, totalPageProduct)}"
										class="page-item"
										th:classappend="${pageClick == stat.index} ? 'active' : ''">
										<a
										class="page-link bg-black bg-gradient text-info hover-bg-primary hover-color-white btn-lg"
										th:href="@{/home/products(pageNo=${stat.index})}"> <span
											th:text="${pageNum}"></span>
									</a>
									</li>

									<!-- Nút Cuối -->
									<li class="page-item"><a
										class="page-link bg-black bg-gradient text-info hover-bg-primary hover-color-white btn-lg"
										th:href="@{/home/products(pageNo=${pageProduct.totalPages - 1})}"
										aria-label="Next"> <span aria-hidden="true">&raquo;</span>
									</a></li>
								</ul>
							</nav>
						</div>

					</div>
				</div>
			</div>
		</div>

		<div th:insert="~{client_layout/footer :: footer}"></div>

		<script>
		
		// Khi người dùng thay đổi radio button, lưu trạng thái vào sessionStorage
		document.querySelectorAll('input[name="price_range"]').forEach((radio) => {
		    radio.addEventListener('change', () => {
		        sessionStorage.setItem('selectedPriceRange', radio.value);
		    });
		});

		// Khi trang được tải, khôi phục trạng thái radio button
		document.addEventListener('DOMContentLoaded', () => {
		    const savedValue = sessionStorage.getItem('selectedPriceRange');
		    if (savedValue) {
		        const radio = document.querySelector(`input[name="price_range"][value="${savedValue}"]`);
		        if (radio) {
		            radio.checked = true;
		        }
		    }
		});


	    
    // Lưu trạng thái của radio button vào localStorage
    function saveRadioState() {
        const checkedRadio = document.querySelector('input[name="categoryId"]:checked');
        if (checkedRadio) {
            localStorage.setItem('selectedCategoryId', checkedRadio.value);
        }
    }

    // Khôi phục trạng thái radio button từ localStorage
    function restoreRadioState() {
        const selectedValue = localStorage.getItem('selectedCategoryId');
        if (selectedValue) {
            const radioToCheck = document.querySelector(`input[name="categoryId"][value="${selectedValue}"]`);
            if (radioToCheck) {
                radioToCheck.checked = true;
            }
        }
    }

    // Gọi hàm khôi phục trạng thái khi trang được tải
    document.addEventListener('DOMContentLoaded', restoreRadioState);

    // Thực hiện khi form thay đổi
    function submitFilterForm() {
        saveRadioState(); // Lưu trạng thái trước khi gửi form
        document.getElementById('filter-form').submit();
    }

    // Chuyển hướng để hiển thị tất cả sản phẩm
    function redirectToProductPage() {
        const categoryIdAll = document.getElementById('categoryIdAll');
        if (categoryIdAll.checked) {
            localStorage.setItem('selectedCategoryId', categoryIdAll.value); // Lưu trạng thái
            window.location.href = "/home/products"; // Chuyển hướng để hiển thị tất cả sản phẩm
        }
    }

    // Hiển thị hoặc ẩn danh sách thêm
    const showMoreBtn = document.getElementById('showMoreBtn');
    const showLessBtn = document.getElementById('showLessBtn');
    const extraList = document.getElementById('extraList');

    showMoreBtn.addEventListener('click', () => {
        extraList.classList.remove('d-none');
        showMoreBtn.classList.add('d-none');
        showLessBtn.classList.remove('d-none');
    });

    showLessBtn.addEventListener('click', () => {
        extraList.classList.add('d-none');
        showMoreBtn.classList.remove('d-none');
        showLessBtn.classList.add('d-none');
    });

    // Gọi redirectToProductPage khi chọn radio "Tất cả"
    document.getElementById('categoryIdAll').addEventListener('change', redirectToProductPage);

    // Gọi submitFilterForm khi chọn các radio khác
    document.querySelectorAll('input[name="categoryId"]').forEach(radio => {
        radio.addEventListener('change', submitFilterForm);
    });
    
    
</script>



		<!-- Bootstrap core JavaScript -->
<!-- 		<script src="/vendor/jquery/jquery.min.js"></script>
		<script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script> -->

		<script src="/assets/js/isotope.min.js"></script>
		<script src="/assets/js/owl-carousel.js"></script>
		<script src="/assets/js/tabs.js"></script>
		<script src="/assets/js/popup.js"></script>
		<script src="/assets/js/custom.js"></script>

		<script type="text/javascript">
	//search voice
    // Check if browser supports Speech Recognition
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.lang = 'vi-VN';
        recognition.interimResults = true; // Enable interim results
        recognition.maxAlternatives = 1;
        
        let isRecognitionEnded = false;
        const searchInput = document.getElementById('searchInput');
        const voiceButton = document.getElementById('voiceButton');
        const searchForm = document.getElementById('searchForm');

        voiceButton.addEventListener('click', () => {
            recognition.start();
            isRecognitionEnded = false; // Reset flag when starting recognition
        });

        recognition.onresult = (event) => {
            let finalTranscript = '';
            let interimTranscript = '';
            
            for (const result of event.results) {
                if (result.isFinal) {
                    finalTranscript += result[0].transcript;
                } else {
                    interimTranscript += result[0].transcript;
                }
            }
            
            // Update the search input with the final or interim result
            searchInput.value = finalTranscript + interimTranscript;
        };

        recognition.onend = () => {
            // Only submit the form if recognition has truly ended and is not restarting
            if (!isRecognitionEnded) {
                isRecognitionEnded = true;
                searchForm.submit();
            }
        };

        // Xử lý lỗi trong quá trình nhận diện giọng nói
        recognition.onerror = (event) => {
            alert('Lỗi nhận diện giọng nói: ' + event.error); // Hiển thị lỗi bằng alert
            microphoneIcon.classList.remove('active'); // Khôi phục màu icon khi có lỗi
            recordingIndicator.style.display = 'none'; // Ẩn chỉ báo ghi âm khi có lỗi
        };
    } else {
        console.log('Không hỗ trợ.');
        document.getElementById('voiceButton').style.display = 'none';
    }
	
	</script>
</body>
</html>
